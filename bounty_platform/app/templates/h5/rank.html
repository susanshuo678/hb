{% extends "base.html" %}
{% block title %}æ’è¡Œæ¦œ{% endblock %}

{% block head %}
<style>
    .rank-header {
        background: linear-gradient(180deg, #d00000 0%, #ff4d4d 100%);
        padding: 2rem 1rem 4rem; color: white; text-align: center;
        border-radius: 0 0 20px 20px;
    }
    .rank-tabs {
        display: flex; justify-content: center; margin-top: -2.5rem; margin-bottom: 1rem;
    }
    .rank-tab-btn {
        background: white; border: 1px solid #ddd; padding: 0.5rem 1.5rem;
        font-weight: bold; color: #666; cursor: pointer; min-width: 100px;
    }
    .rank-tab-btn:first-child { border-radius: 20px 0 0 20px; border-right: none; }
    .rank-tab-btn:last-child { border-radius: 0 20px 20px 0; }
    .rank-tab-btn.active { background: #fff5e6; color: #d00000; border-color: #d00000; z-index: 1; }
    
    .rank-list { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
    .rank-item { display: flex; align-items: center; padding: 1rem; border-bottom: 1px solid #f9f9f9; }
    .rank-num { width: 30px; font-weight: bold; text-align: center; font-style: italic; color: #999; }
    .rank-1 { color: #f1c40f; font-size: 1.2rem; }
    .rank-2 { color: #bdc3c7; font-size: 1.1rem; }
    .rank-3 { color: #e67e22; font-size: 1.1rem; }
    
    .rank-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; margin: 0 10px; background: #eee; }
    
    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #eee; display: flex; justify-content: space-around; padding: 0.8rem 0; z-index: 999; }
    .nav-item { text-align: center; color: #999; text-decoration: none; font-size: 0.8rem; }
    .nav-item.active { color: #d00000; font-weight: bold; }
    .nav-item i { display: block; font-size: 1.4rem; margin-bottom: 0.2rem; }
</style>
{% endblock %}

{% block content %}
<div class="rank-header">
    <h3 class="fw-bold"><i class="fas fa-trophy"></i> é£äº‘æ¦œå•</h3>
    <p class="small opacity-75 mb-0">å®æ—¶æ›´æ–° Â· è†œæ‹œå¤§ä½¬</p>
</div>

<div class="container pb-5">
    <div class="rank-tabs">
        <div class="rank-tab-btn active" onclick="switchTab('rich')" id="tab-rich">ğŸ’° å¯Œè±ªæ¦œ</div>
        <div class="rank-tab-btn" onclick="switchTab('work')" id="tab-work">ğŸ å‹¤å¥‹æ¦œ</div>
    </div>

    <div id="list-rich" class="rank-list">
        {% for u in rich_list %}
        <div class="rank-item">
            <div class="rank-num {% if loop.index <= 3 %}rank-{{ loop.index }}{% endif %}">
                {% if loop.index == 1 %}<i class="fas fa-crown"></i>
                {% elif loop.index == 2 %}<i class="fas fa-medal"></i>
                {% elif loop.index == 3 %}<i class="fas fa-medal"></i>
                {% else %}{{ loop.index }}{% endif %}
            </div>
            <img src="{{ u.avatar or '/static/img/default_avatar.png' }}" class="rank-avatar" onerror="this.src='https://ui-avatars.com/api/?name={{ u.username }}'">
            <div class="flex-grow-1">
                <div class="fw-bold">{{ u.username[:2] }}***{{ u.username[-1:] }}</div>
            </div>
            <div class="text-danger fw-bold">Â¥ {{ "%.2f"|format(u.balance) }}</div>
        </div>
        {% else %}
        <div class="p-4 text-center text-muted">æš‚æ— æ•°æ®</div>
        {% endfor %}
    </div>

    <div id="list-work" class="rank-list" style="display: none;">
        {% for row in diligence_list %}
        <div class="rank-item">
            <div class="rank-num {% if loop.index <= 3 %}rank-{{ loop.index }}{% endif %}">
                {% if loop.index == 1 %}<i class="fas fa-crown"></i>
                {% elif loop.index == 2 %}<i class="fas fa-medal"></i>
                {% elif loop.index == 3 %}<i class="fas fa-medal"></i>
                {% else %}{{ loop.index }}{% endif %}
            </div>
            <img src="{{ row[0].avatar or '/static/img/default_avatar.png' }}" class="rank-avatar" onerror="this.src='https://ui-avatars.com/api/?name={{ row[0].username }}'">
            <div class="flex-grow-1">
                <div class="fw-bold">{{ row[0].username[:2] }}***{{ row[0].username[-1:] }}</div>
            </div>
            <div class="text-primary fw-bold">{{ row[1] }} å•</div>
        </div>
        {% else %}
        <div class="p-4 text-center text-muted">æš‚æ— æ•°æ®</div>
        {% endfor %}
    </div>
</div>

<div class="bottom-nav">
    <a href="/h5/index" class="nav-item">
        <i class="fas fa-home"></i> ä»»åŠ¡å¤§å…
    </a>
    <a href="/h5/rank" class="nav-item active">
        <i class="fas fa-chart-bar"></i> æ’è¡Œæ¦œ
    </a>
    <a href="/h5/mine" class="nav-item">
        <i class="fas fa-user"></i> ä¸ªäººä¸­å¿ƒ
    </a>
</div>
{% endblock %}

{% block scripts %}
<script>
    function switchTab(type) {
        // åˆ‡æ¢æŒ‰é’®æ ·å¼
        document.querySelectorAll('.rank-tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-' + type).classList.add('active');
        
        // åˆ‡æ¢åˆ—è¡¨æ˜¾ç¤º
        document.getElementById('list-rich').style.display = (type === 'rich') ? 'block' : 'none';
        document.getElementById('list-work').style.display = (type === 'work') ? 'block' : 'none';
    }
</script>
{% endblock %}