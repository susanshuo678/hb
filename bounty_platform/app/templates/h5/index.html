{% extends "base.html" %}
{% block title %}ä»»åŠ¡å¤§å…{% endblock %}

{% block head %}
<style>
    .banner-container { border-radius: 15px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 1rem; }
    .carousel-item img { width: 100%; height: 160px; object-fit: cover; }
    .notice-bar { background: #fff5eb; color: #d35400; padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.9rem; margin-bottom: 1rem; display: flex; align-items: center; }
    .notice-icon { margin-right: 0.5rem; animation: bell-shake 2s infinite; }
    
    .category-nav { display: flex; overflow-x: auto; white-space: nowrap; padding-bottom: 10px; margin-bottom: 10px; -webkit-overflow-scrolling: touch; }
    .category-nav::-webkit-scrollbar { display: none; }
    
    .cat-item { display: inline-block; padding: 8px 16px; margin-right: 10px; background: white; border-radius: 20px; color: #666; font-size: 0.9rem; border: 1px solid #eee; text-decoration: none; transition: all 0.2s; }
    .cat-item.active { background: #d00000; color: white; border-color: #d00000; font-weight: bold; box-shadow: 0 4px 10px rgba(208,0,0,0.3); }
    
    .task-card { background: white; border-radius: 12px; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.02); border: 1px solid #f0f0f0; transition: transform 0.2s; }
    .task-card:active { transform: scale(0.98); }
    
    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #eee; display: flex; justify-content: space-around; padding: 0.8rem 0; z-index: 999; }
    .nav-item { text-align: center; color: #999; text-decoration: none; font-size: 0.8rem; }
    .nav-item.active { color: #d00000; font-weight: bold; }
    .nav-item i { display: block; font-size: 1.4rem; margin-bottom: 0.2rem; }
    @keyframes bell-shake { 0%, 100% { transform: rotate(0); } 10%, 30%, 50% { transform: rotate(15deg); } 20%, 40% { transform: rotate(-15deg); } }
</style>
{% endblock %}

{% block content %}
{% if banners %}
<div class="banner-container">
    <div id="homeCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
            {% for b in banners %}
            <div class="carousel-item {% if loop.first %}active{% endif %}">
                <a href="{{ b.link_url or '#' }}"><img src="{{ b.image_path }}" class="d-block w-100"></a>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

{% if announcement %}
<div class="notice-bar">
    <i class="fas fa-bullhorn notice-icon"></i>
    <marquee scrollamount="5">{{ announcement }}</marquee>
</div>
{% endif %}

<div class="category-nav">
    <a href="/h5/index?cat=all" class="cat-item {% if current_cat == 'all' %}active{% endif %}">å…¨éƒ¨</a>
    {% for c in categories %}
    <a href="/h5/index?cat={{ c.code }}" class="cat-item {% if current_cat == c.code %}active{% endif %}">
        {{ c.icon }} {{ c.name }}
    </a>
    {% endfor %}
</div>

<div class="d-flex justify-content-between align-items-center mb-3 px-1">
    <h5 class="fw-bold m-0"><i class="fas fa-fire text-danger me-2"></i>æœ€æ–°ä»»åŠ¡</h5>
    <span class="text-muted small">å…± {{ tasks|length }} ä¸ª</span>
</div>

<div class="px-1 pb-5">
    {% if tasks %}
        {% for task in tasks %}
        <div class="task-card" onclick="location.href='/h5/task/{{ task.id }}'">
            <div class="d-flex justify-content-between">
                <div>
                    <h6 class="fw-bold mb-1 text-dark">
                        {% for c in categories %}
                            {% if task.category == c.code %}
                            <span class="badge bg-{{ c.color }} me-1" style="font-size:0.7em">{{ c.name[:2] }}</span>
                            {% endif %}
                        {% endfor %}
                        
                        {{ task.title }}
                    </h6>
                    <div class="mt-2">
                        {% if task.text_req != 'none' %}<span class="badge bg-light text-secondary border small">ğŸ“ å¡«å­—</span>{% endif %}
                        {% if task.image_req != 'none' %}<span class="badge bg-light text-secondary border small">ğŸ“¸ æˆªå›¾</span>{% endif %}
                    </div>
                </div>
                <div class="text-end">
                    <div class="fs-4 fw-bold text-danger">Â¥ {{ task.reward_desc }}</div>
                    <button class="btn btn-sm btn-outline-danger rounded-pill mt-1">å»æ¥å•</button>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="text-center py-5 text-muted"><p>è¯¥åˆ†ç±»ä¸‹æš‚æ— ä»»åŠ¡</p></div>
    {% endif %}
</div>

<div class="bottom-nav">
    <a href="/h5/index" class="nav-item active">
        <i class="fas fa-home"></i> ä»»åŠ¡å¤§å…
    </a>
    <a href="/h5/rank" class="nav-item">
        <i class="fas fa-chart-bar"></i> æ’è¡Œæ¦œ
    </a>
    <a href="/h5/mine" class="nav-item">
        <i class="fas fa-user"></i> ä¸ªäººä¸­å¿ƒ
    </a>
</div>
{% endblock %}