{% extends "base.html" %}
{% block title %}ç´ æåº“ç®¡ç†{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="fw-bold">ğŸ’ ç´ æå¼¹è¯åº“</h4>
        <div>
            <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#newCatModal">
                <i class="fas fa-folder-plus"></i> æ–°å»ºåˆ†ç±»
            </button>
            <a href="/admin/dashboard" class="btn btn-outline-secondary">è¿”å›åå°</a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4">
            <div class="list-group shadow-sm">
                {% for cat in categories %}
                <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" onclick="selectCat('{{ cat.id }}', '{{ cat.name }}')">
                    <div>
                        <div class="fw-bold">{{ cat.name }}</div>
                        <small class="text-muted">æ€»æ•°: {{ cat.total_count }} | å·²é¢†: {{ cat.used_count }}</small>
                    </div>
                    <i class="fas fa-chevron-right text-muted"></i>
                </a>
                {% endfor %}
            </div>
        </div>

        <div class="col-md-8">
            <div class="card card-custom bg-white p-4" id="uploadCard" style="display: none;">
                <h5 class="fw-bold mb-3">ğŸ“‚ æ­£åœ¨ç®¡ç†ï¼š<span id="currentCatName" class="text-primary"></span></h5>
                
                <form action="/admin/materials/upload" method="post" enctype="multipart/form-data">
                    <input type="hidden" name="cat_id" id="currentCatId">
                    
                    <div class="mb-4">
                        <label class="form-label fw-bold">1. æ‰¹é‡é€‰æ‹©å›¾ç‰‡ (å¯å¤šé€‰)</label>
                        <input type="file" name="files" class="form-control" multiple accept="image/*">
                        <div class="form-text">æ”¯æŒä¸€æ¬¡æ€§é€‰æ‹© 10 å¼ ã€100 å¼ å›¾ç‰‡ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ç”Ÿæˆç´ ææ¡ç›®ã€‚</div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label fw-bold">2. æ‰¹é‡è¾“å…¥æ–‡æ¡ˆ</label>
                        <textarea name="texts" class="form-control" rows="10" placeholder="ç¬¬ä¸€è¡Œæ–‡æ¡ˆ...
ç¬¬äºŒè¡Œæ–‡æ¡ˆ...
ç¬¬ä¸‰è¡Œæ–‡æ¡ˆ...

(æ¯è¡Œå°†ä½œä¸ºä¸€æ¡ç‹¬ç«‹çš„æ–‡æ¡ˆç´ æï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†å›¾ç‰‡å’Œæ–‡æ¡ˆè¿›è¡Œé…å¯¹ç»„åˆ)"></textarea>
                    </div>

                    <button type="submit" class="btn btn-success w-100 py-2 fw-bold">ğŸš€ å¼€å§‹æ‰¹é‡å¯¼å…¥</button>
                </form>
            </div>
            
            <div class="text-center py-5 text-muted" id="placeholder">
                <i class="fas fa-arrow-left me-2"></i> è¯·å…ˆåœ¨å·¦ä¾§é€‰æ‹©ä¸€ä¸ªåˆ†ç±»
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="newCatModal" tabindex="-1">
    <div class="modal-dialog">
        <form action="/admin/materials/category/new" method="post" class="modal-content">
            <div class="modal-header"><h5 class="modal-title">æ–°å»ºåˆ†ç±»</h5></div>
            <div class="modal-body">
                <input type="text" name="name" class="form-control" placeholder="ä¾‹å¦‚ï¼šå°çº¢ä¹¦3æœˆç¬¬ä¸€æ‰¹" required>
            </div>
            <div class="modal-footer"><button type="submit" class="btn btn-primary">åˆ›å»º</button></div>
        </form>
    </div>
</div>

<script>
    function selectCat(id, name) {
        document.getElementById('uploadCard').style.display = 'block';
        document.getElementById('placeholder').style.display = 'none';
        document.getElementById('currentCatName').innerText = name;
        document.getElementById('currentCatId').value = id;
    }
</script>
{% endblock %}