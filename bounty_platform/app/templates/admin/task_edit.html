{% extends "base.html" %}
{% block title %}å‘å¸ƒæ–°ä»»åŠ¡{% endblock %}
{% block head %}<style>body { background-color: #f3f4f6; }</style>{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-9">
            <h4 class="fw-bold mb-4">ğŸ“ å‘å¸ƒä»»åŠ¡</h4>
            <div class="card card-custom p-4 bg-white">
                <form action="/admin/task/new" method="post" enctype="multipart/form-data">
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <label class="form-label fw-bold">ä»»åŠ¡æ ‡é¢˜</label>
                            <input type="text" name="title" class="form-control" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">ä»»åŠ¡åˆ†ç±»</label>
                            <select name="category" class="form-select">
                                {% for c in categories %}<option value="{{ c.code }}">{{ c.name }}</option>{% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="card bg-light border p-3 mb-4">
                        <div class="row">
                            <div class="col-md-4">
                                <label class="form-label fw-bold text-success">ç»“ç®—æ¨¡å¼</label>
                                <div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="price_mode" id="pm_fixed" value="fixed" checked onchange="toggleMode()">
                                        <label class="form-check-label" for="pm_fixed">å›ºå®šé‡‘é¢</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="price_mode" id="pm_dynamic" value="dynamic" onchange="toggleMode()">
                                        <label class="form-check-label" for="pm_dynamic">å®¡æ ¸æ—¶å®šä»·</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-8" id="fixedBox">
                                <label class="form-label fw-bold">å•ä»· (å…ƒ)</label>
                                <input type="number" step="0.01" name="price" id="inputPrice" class="form-control" placeholder="5.00">
                                <div class="form-text">ç”¨æˆ·å®Œæˆä¸€å•ï¼Œç›´æ¥å‘æ”¾æ­¤é‡‘é¢ã€‚</div>
                            </div>

                            <div class="col-md-8" id="dynamicBox" style="display:none;">
                                <div class="mb-2">
                                    <label class="form-label fw-bold">å±•ç¤ºä»·æ ¼åŒºé—´ (ç”¨äºå¸å¼•çœ¼çƒ)</label>
                                    <input type="text" name="reward_desc_input" id="inputRewardDesc" class="form-control" placeholder="ä¾‹å¦‚ï¼š5-20å…ƒ / ä¸Šä¸å°é¡¶">
                                </div>
                                <div>
                                    <label class="form-label fw-bold">å®šä»·è§„åˆ™è¯´æ˜ (è®©ç”¨æˆ·çŸ¥é“æ€ä¹ˆå¤šæ‹¿é’±)</label>
                                    <textarea name="pricing_rule" class="form-control" rows="2" placeholder="ä¾‹å¦‚ï¼šåŸºç¡€æ³¨å†Œ5å…ƒï¼Œå……å€¼å†é€10å…ƒï¼Œæˆªå›¾æ¸…æ™°é¢å¤–å¥–2å…ƒ..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card bg-warning-subtle border-warning p-3 mb-4">
                        <label class="form-label fw-bold text-dark"><i class="fas fa-boxes me-1"></i> ç»‘å®šç´ æå¼¹è¯åº“ (é€‰å¡«)</label>
                        <div class="input-group">
                            <select name="material_cat_id" class="form-select border-warning">
                                <option value="0">ğŸš« ä¸ä½¿ç”¨ç´ æåº“ (ç”¨æˆ·è‡ªå·±æ‰¾å›¾)</option>
                                {% for mc in mat_categories %}
                                <option value="{{ mc.id }}">ğŸ“¦ {{ mc.name }} (å‰©ä½™: {{ mc.total_count - mc.used_count }})</option>
                                {% endfor %}
                            </select>
                            <a href="/admin/materials" target="_blank" class="btn btn-warning text-dark border-warning fw-bold">
                                <i class="fas fa-plus-circle"></i> å»åˆ›å»ºç´ æåº“
                            </a>
                        </div>
                        <div class="form-text text-dark opacity-75">
                            ä¸‹æ‹‰æ¡†ä¸ºç©ºï¼Ÿè¯·å…ˆç‚¹å‡»å³ä¾§æŒ‰é’®å»ä¸Šä¼ ç´ æã€‚ç»‘å®šåï¼Œç”¨æˆ·æ¥å•å°†è‡ªåŠ¨é¢†å–ä¸€å¥—â€œç‹¬å®¶â€å›¾æ–‡ï¼Œé¢†å®Œå³æ­¢ã€‚
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">ä»»åŠ¡æ­¥éª¤è¯´æ˜</label>
                        <textarea name="description" class="form-control" rows="5" required></textarea>
                    </div>

                    <div class="row mb-4">
                        <div class="col-6">
                            <label class="form-label small text-muted">æ–‡å­—éªŒè¯</label>
                            <select name="text_req" class="form-select form-select-sm">
                                <option value="required">å¿…å¡«</option><option value="none">æ— éœ€</option>
                            </select>
                        </div>
                        <div class="col-6">
                            <label class="form-label small text-muted">æˆªå›¾éªŒè¯</label>
                            <select name="image_req" class="form-select form-select-sm">
                                <option value="required">å¿…å¡«</option><option value="none">æ— éœ€</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary w-100 py-2 fw-bold">å‘å¸ƒä¸Šçº¿</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function toggleMode() {
        var isDynamic = document.getElementById('pm_dynamic').checked;
        var fixedBox = document.getElementById('fixedBox');
        var dynamicBox = document.getElementById('dynamicBox');
        
        if (isDynamic) { 
            fixedBox.style.display = 'none';
            dynamicBox.style.display = 'block';
            document.getElementById('inputPrice').value = 0; // åŠ¨æ€æ¨¡å¼ä»·æ ¼ç½®0
        } else { 
            fixedBox.style.display = 'block';
            dynamicBox.style.display = 'none';
        }
    }
</script>
{% endblock %}