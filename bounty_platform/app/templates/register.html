{% extends "base.html" %}

{% block title %}æ³¨å†Œè´¦å·{% endblock %}

{% block content %}
<div class="row justify-content-center mt-5">
    <div class="col-md-6 col-lg-4">
        <div class="card card-custom p-4 bg-white">
            <h3 class="text-center fw-bold mb-4 text-dark">âœ¨ æ¬¢è¿åŠ å…¥</h3>
            
            {% if error %}
            <div class="alert alert-danger py-2 small">{{ error }}</div>
            {% endif %}

            <form action="/register" method="post">
                <div class="mb-3">
                    <label class="form-label fw-bold small text-muted">ç”¨æˆ·å</label>
                    <input type="text" name="username" class="form-control rounded-pill px-3" placeholder="è®¾ç½®ç”¨æˆ·å" required>
                </div>
                
                <div class="mb-3">
                    <label class="form-label fw-bold small text-muted">å¯†ç </label>
                    <input type="password" name="password" class="form-control rounded-pill px-3" placeholder="è®¾ç½®ç™»å½•å¯†ç " required>
                </div>

                <div class="mb-4">
                    <label class="form-label fw-bold small text-muted">éªŒè¯ç  (çº¯æ•°å­—)</label>
                    <div class="input-group">
                        <input type="text" name="captcha" class="form-control rounded-start-pill px-3" placeholder="è¾“å…¥4ä½æ•°å­—" required>
                        <img src="/captcha" id="captchaImg" class="border rounded-end-pill" style="cursor: pointer; height: 38px;" onclick="refreshCaptcha()" title="ç‚¹å‡»åˆ·æ–°">
                    </div>
                </div>

                {% if invite_code %}
                <div class="mb-4">
                    <label class="form-label fw-bold small text-muted text-success">
                        <i class="fas fa-user-friends me-1"></i> æ¨èäººID
                    </label>
                    <input type="text" name="invite_code" class="form-control rounded-pill px-3 bg-light" value="{{ invite_code }}" readonly>
                </div>
                {% endif %}

                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-red rounded-pill py-2 fw-bold">ç«‹å³æ³¨å†Œ</button>
                    <a href="/login" class="btn btn-outline-secondary rounded-pill py-2">å·²æœ‰è´¦å·ï¼Ÿå»ç™»å½•</a>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="successModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content text-center p-4 border-0 shadow">
            <div class="mb-3">
                <i class="fas fa-check-circle text-success fa-4x animate__animated animate__bounceIn"></i>
            </div>
            <h4 class="fw-bold mb-2">æ³¨å†ŒæˆåŠŸï¼</h4>
            <p class="text-muted small mb-4">æ¬¢è¿åŠ å…¥çº¢ç™½æ‚¬èµï¼Œå¼€å¯èµšé’±ä¹‹æ—…ã€‚</p>
            <button onclick="location.href='/login'" class="btn btn-success w-100 rounded-pill fw-bold">çŸ¥é“äº†ï¼Œå»ç™»å½•</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function refreshCaptcha() {
        document.getElementById('captchaImg').src = "/captcha?" + new Date().getTime();
    }

    window.onload = function() {
        // ğŸŸ¢ åŒé‡ä¿é™©ï¼šåŠ ä¸Š |default(False) é˜²æ­¢ undefined æŠ¥é”™
        var isSuccess = {{ success|default(False)|tojson }};
        
        if (isSuccess) {
            var myModal = new bootstrap.Modal(document.getElementById('successModal'));
            myModal.show();
        }
    }
</script>
{% endblock %}