<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}çº¢ç™½æ‚¬èµ V3 Enterprise{% endblock %}</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        body { min-height: 100vh; background-color: #f4f6f9; display: flex; }
        
        /* ä¾§è¾¹æ æ ·å¼ */
        #sidebar {
            min-width: 250px;
            max-width: 250px;
            background: #343a40;
            color: #fff;
            transition: all 0.3s;
            display: flex; flex-direction: column;
        }
        #sidebar .sidebar-header { padding: 20px; background: #343a40; border-bottom: 1px solid #4b545c; }
        #sidebar ul.components { padding: 20px 0; border-bottom: 1px solid #4b545c; }
        #sidebar ul li a { padding: 10px 20px; font-size: 1.1em; display: block; color: #c2c7d0; text-decoration: none; }
        #sidebar ul li a:hover { color: #fff; background: #494e53; }
        #sidebar ul li.active > a { background: #007bff; color: #fff; }
        
        /* å†…å®¹åŒºæ ·å¼ */
        #content { width: 100%; padding: 20px; min-height: 100vh; transition: all 0.3s; }
        
        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            #sidebar { margin-left: -250px; }
            #sidebar.active { margin-left: 0; }
        }
    </style>
    {% block head %}{% endblock %}
</head>
<body>

    {% if user and user.is_admin %}
    <nav id="sidebar">
        <div class="sidebar-header">
            <h3>ğŸ¦„ çº¢ç™½æ‚¬èµ</h3>
            <div class="small text-muted">V3.0 Enterprise</div>
        </div>

        <ul class="list-unstyled components">
            <li><a href="/admin/dashboard"><i class="fas fa-tachometer-alt me-2"></i> æ•°æ®çœ‹æ¿</a></li>
            <li><a href="/admin/materials"><i class="fas fa-images me-2"></i> ç´ æå¼¹è¯åº“</a></li>
            <li><a href="/admin/audit"><i class="fas fa-check-circle me-2"></i> ä»»åŠ¡å®¡æ ¸</a></li>
            <li><a href="/admin/deposit/list"><i class="fas fa-wallet me-2"></i> è´¢åŠ¡ç®¡ç†</a></li>
            <li><a href="/admin/users"><i class="fas fa-users me-2"></i> ä¼šå‘˜é£æ§</a></li>
            <li><a href="/admin/audit_logs"><i class="fas fa-history me-2"></i> å®¡è®¡æ—¥å¿—</a></li>
            <li><a href="/admin/settings"><i class="fas fa-cogs me-2"></i> ç³»ç»Ÿè®¾ç½®</a></li>
        </ul>
        
        <div class="mt-auto p-3">
             <a href="/logout" class="btn btn-danger w-100"><i class="fas fa-sign-out-alt"></i> é€€å‡ºç™»å½•</a>
        </div>
    </nav>
    {% endif %}

    <div id="content">
        <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm mb-4 rounded">
            <div class="container-fluid">
                <button type="button" id="sidebarCollapse" class="btn btn-dark d-inline-block d-lg-none">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="ms-auto d-flex align-items-center">
                    {% if user %}
                        <span class="me-3">æ¬¢è¿, <strong>{{ user.username }}</strong></span>
                        {% if not user.is_admin %}
                        <a href="/logout" class="btn btn-sm btn-outline-danger">é€€å‡º</a>
                        {% endif %}
                    {% else %}
                        <a href="/login" class="btn btn-primary btn-sm">ç™»å½•</a>
                    {% endif %}
                </div>
            </div>
        </nav>

        {% block content %}{% endblock %}
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <script>
        $(document).ready(function () {
            $('#sidebarCollapse').on('click', function () {
                $('#sidebar').toggleClass('active');
            });
            
            // å…¨å±€ Ajax é”™è¯¯å¤„ç†
            $(document).ajaxError(function(event, jqxhr, settings, thrownError) {
                if (jqxhr.status == 401) {
                    Swal.fire('ç™»å½•è¿‡æœŸ', 'è¯·é‡æ–°ç™»å½•', 'warning').then(() => window.location.href='/login');
                } else {
                    Swal.fire('ç³»ç»Ÿé”™è¯¯', 'æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                }
            });
        });
        
        // é€šç”¨ API è°ƒç”¨å°è£…
        function apiPost(url, data, successCb) {
            $.post(url, data, function(res) {
                if (res.code === 200) {
                    Swal.fire({
                        title: 'æˆåŠŸ',
                        text: res.message,
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false
                    }).then(() => {
                        if(successCb) successCb(res);
                        else window.location.reload();
                    });
                } else {
                    Swal.fire('å¤±è´¥', res.message, 'error');
                }
            });
        }
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>